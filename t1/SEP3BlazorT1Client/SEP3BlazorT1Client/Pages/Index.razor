@inject IResidenceService ResidenceService;
@page "/"
@using SEP3BlazorT1Client.Models
@using SEP3BlazorT1Client.Data
@using Authentication

@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager


@* <h1>Proof of concept</h1> *@
@* <span>T1 --> T2 REST API --> T3 SOAP API with Postgres DB *@
@* </span> *@
@* *@
@* <div> *@
@*      *@
@*     <p>Fetched Message: </p> *@
@*     @if (_residence != null) *@
@*     { *@
@*     <p>@_residence.ToString()</p> *@
@*     } *@
@*     <Input type="number" @oninput="(e) => { _id = Int32.Parse(e.Value.ToString()); }"/> *@
@*     <button type="submit" @onclick="CreateNewResidence" class="btn btn-primary"> *@
@*         FETCH CONCEPT MESSAGE *@
@*     </button> *@
@* </div> *@
 <div class="mat-layout-grid">
            <div class="mat-layout-grid-inner">
                <div class="mat-layout-grid-cell"></div>
                <div class="mat-layout-grid-cell mat-layout-grid-cell-span-4">
                    <MatCard class="demo-mat-card">
                        <MatCardContent style="padding: 1rem">
                            <table>
                                <tr>
                                    <td>
                                        <img class="profile-img" style="margin-left: 6em; margin-bottom: 2em" src="https://lh5.googleusercontent.com/-b0-k99FZlyE/AAAAAAAAAAI/AAAAAAAAAAA/eu7opA4byxI/photo.jpg?sz=120" alt="">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <MatTextField @bind-Value="@email" Label="Email" Outlined="true" Style="margin-left: 3em"></MatTextField>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <MatTextField @bind-Value="@password" Dense="true" Label="Password" Outlined="true" Style="margin-left: 3em;"></MatTextField>
                                    </td>
                                </tr>
                                  <tr>
                                      <td>
                                           <MatButton Raised="true" Style="margin-left: 8em;" OnClick="@(() =>PerformLogin())">Log in</MatButton>
                                      </td>
                                      </tr>
                            </table>
                        </MatCardContent>
                        <MatDivider Inset="true"></MatDivider>
                                <MatCardActions>
                                    <MatButton Link="/registerhost">Don't have an account, register here</MatButton>
                                </MatCardActions>
                            </MatCard>
                </div>
                <div class="mat-layout-grid-cell"></div>
            </div>
        </div>



@code
{
    private string email;
    private string password;
    private string ErrorMessage;

    public async Task PerformLogin()
    {
        Console.WriteLine("Loggin in");
        ErrorMessage = "";
        try {
            ((CustomAuthenticationStateProvider) AuthenticationStateProvider).StartConnection();
            await ((CustomAuthenticationStateProvider) AuthenticationStateProvider).ValidateLogin(Email, Password);
            Email = "";
            Password = "";
            NavigationManager.NavigateTo("/");
        } catch (Exception e) {
            ErrorMessage = e.Message;
        }
    }


}
