@page "/Messages"
@inject NavigationManager NavigationManager; 
@inject AuthenticationStateProvider AuthenticationStateProvider; 
@inject IUserService UserService
@using SEP3BlazorT1Client.Models
@using Microsoft.AspNetCore.SignalR.Client
@using SEP3BlazorT1Client.Data
@using System.Text.Json
<h3>Messages</h3>

@code {
    private IEnumerable<Message> _messages = new List<Message>();
    private HubConnection _connection;
    private User _sender;
    private User _receiver;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        _sender = await UserService.GetUserByEmailAsync(user.Identity.Name);
        _connection = new HubConnectionBuilder().WithUrl($"https://localhost:5001/chat?email={_sender.Email}").WithAutomaticReconnect().Build();
        _connection.On<string>("ReceiveMessage", ReceiveMessage);

    }

    private void ReceiveMessage(string message)
    {
        var messageReceived = JsonSerializer.Deserialize<Message>(message); 
        
    }

}